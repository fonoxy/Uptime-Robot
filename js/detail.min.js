var firstIndex=0,lastIndex=5;function serializeComment(t,e=!1){if(console.log(t),t.hasOwnProperty("type")){if("mention"===t.type)return`@${t.name}`;if("paragraph"===t.type){const a=t.children.map(t=>serializeComment(t)).join(""),s=t.children[t.children.length-1],o=(!s.hasOwnProperty("type")||"text"===s.type)&&""===s.text;return""!==a&&!o||e?a:a+"<br/>"}}return t.hasOwnProperty("type")&&"text"!==t.type?"":t.text}function loadMore(){var t="";lastIndex>logs.length&&($("#load-more-logs-button").addClass("uk-hidden"),$("#load-more-logs-end").removeClass("uk-hidden")),slicedLogs=logs.slice(firstIndex,lastIndex),$.each(slicedLogs,function(e,a){let s=trans("status.running_again"),o=null,n="icon-arrow-up-circle",i=trans("common.was");if(0==e&&0==firstIndex&&(i=trans("common.is")),"down"==a.label)s=trans("status.down_for").replace("%s",a.duration),n="icon-arrow-down-circle";else if("paused"==a.label)s=trans("status.monitor_paused").replace("%s",i),n="icon-pause-circle";else if("started"==a.label)s=trans("status.monitor_started"),n="icon-play-circle";else if("comment"===a.class){const t=JSON.parse(a.comment),e=t.map((e,a)=>serializeComment(e,a===t.length-1)).join("");s=`Comment by ${a.authorName}`,o=e,n="icon-comment"}t+='<div class="psp-announcement psp-alert'+(0!=firstIndex?" uk-animation-slide-top-small":"")+'" data-ts="'+a.time+'"><div class="uk-flex uk-flex-top">',"comment"===a.class?t+='\n            <svg class="psp-announcement-icon" fill="currentColor" viewBox="0 0 16 16" width="24" height="24">\n                <path d="M2.678 11.894a1 1 0 0 1 .287.801 11 11 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8 8 0 0 0 8 14c3.996 0 7-2.807 7-6s-3.004-6-7-6-7 2.808-7 6c0 1.468.617 2.83 1.678 3.894m-.493 3.905a22 22 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a10 10 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9 9 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105" />\n                <path d="M4 5.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8m0 2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5" />\n            </svg>\n            ':t+='<svg class="psp-announcement-icon icon '+n+' uk-flex-none"><use href="images/symbol-defs.svg#'+n+'"></use></svg>',t+='    <div class="uk-flex-auto">',t+='        <h4 class="uk-margin-remove">'+s+"</h4>",null!==o&&(t+=`<p style="font-size: 16px">${o}</p>`),"down"==a.label&&null!=a.reason.detail&&(t+='<p class="psp-alert-reason">The reason '+i+"  <strong>"+a.reason.detail.short+"</strong>.",a.reason.code.length<=3&&(t+='<strong class="uk-label uk-label-danger">'+a.reason.code+"</strong>"),t+="</p>",void 0!==a.reason.detail.full&&(t+='<p class="psp-alert-reason-detail uk-text-muted"><strong>'+trans("status.details")+":</strong>"+a.reason.detail.full+"</p>"));const r=formatLocalizedDateTime(a.dateGMT);t+='        <p class="uk-text-muted font-14" uk-tooltip title="'+r+' GMT">'+r+" ("+window.timeZone+")</p>",t+="    </div>",t+="</div></div>"}),$(".event-table-wrapper").append(t),step=lastIndex-firstIndex,firstIndex=lastIndex,lastIndex+=step}function callMonitorDetail(t){$.ajax({type:"GET",url:window.pspApiPath,dataType:"json",cache:!1,retryLimit:2,success:function(e){var a=e.statistics.counts.down,s=e.statistics.counts.up,o=e.statistics.counts.paused,n=e.statistics.counts.total;$("#totalCount").text(n),$("#upCount").text(s),$("#downCount").text(a),$("#pausedCount").text(o),$(".psp-main-status-dot").removeClass("is-grey is-error"),0==s&&0==o?$(".psp-main-status-dot").addClass("is-error"):0!=a?($(".psp-main-status-dot").addClass("is-warning"),playAlertSound()):o==n&&$(".psp-main-status-dot").addClass("is-grey"),window.timeZone=e.timezone,$("title").text(e.monitor.name+" - "+e.title),$(".psp-main-status-wrap .psp-main-status-dot").removeClass("is-grey is-error"),"success"==e.monitor.statusClass?$(".psp-main-status").html('<span class="uk-flex-inline psp-mon-detail-name"><span class="uk-display-inline-block">'+e.monitor.name+"</span></span> "+trans("common.is")+' <span class="uk-text-primary">'+trans("common.operational").toLowerCase()+"</span>"):"danger"==e.monitor.statusClass?($(".psp-main-status-wrap .psp-main-status-dot").addClass("is-error"),$(".psp-main-status").html(e.monitor.name+" "+trans("common.is")+' <span class="uk-text-danger">'+trans("common.down").toLowerCase()+"</span>"),playAlertSound()):($(".psp-main-status-wrap .psp-main-status-dot").addClass("is-grey"),$(".psp-main-status").html(e.monitor.name+" "+trans("common.is")+' <span class="uk-text-muted">'+trans("common.not_monitored")+"</span>"));var i=e.monitor.type.charAt(0).toUpperCase()+e.monitor.type.slice(1);if(null===e.monitor.url)$(".psp-monitor-interval").text(e.monitor.checkInterval);else{var r=e.monitor.url;e.monitor.url.startsWith("http")||(r="http://"+r);var l=null===e.monitor.url?"":" "+trans("common.for")+' <a href="'+r+'" class="uk-text-truncate uk-display-inline-block" title="'+e.monitor.url+'">'+e.monitor.url+"</a>";$(".psp-monitor-interval").html(i+" "+trans("common.monitoring")+l+", "+e.monitor.checkInterval.toLowerCase())}(e.monitor.statusClass="success")?trans("common.operational"):(e.monitor.statusClass="danger")?trans("common.down"):trans("common.paused");var d="",m=e.days||e.monitor.dailyRatios.map(function(t){return t.date}),c=e.monitor.dailyRatios,p=window.innerWidth,u=90,h=window.compact?920:880,v=window.compact?20:30,g=window.compact?10.25:9.8,f=6;p<=768&&(u=30,g=19.8,f=12,h=588,v=window.compact?30:60);for(var x=90-u,w=x;w<90;w++){var k=c[89-w],y=!1,b=new Date(m[w]).getTime()/1e3,C=k.ratio+"%";b<e.monitor.createdAt-86400&&(y=!0);var M="#3bd671",I="1";1==y||"black"==k.label?(M="#687790",C=trans("common.no_records")):k.ratio<100&&k.ratio>=99?(M="#3bd671",I="0.5"):k.ratio<99&&k.ratio>=95?M="#f29030":k.ratio<95&&(M="#df484a"),d+='<rect height="'+v+'" width="'+f+'" x="'+(w-x)*g+'" y="0" fill="'+M+'" fill-opacity="'+I+'" rx="'+f/2+'" ry="'+f/2+"\" uk-tooltip=\"<div class='uk-text-muted font-12'>"+m[w]+"</div>                    "+C+'" />'}var T='                    <div class="psp-monitor-row">                        <div class="uk-flex uk-flex-between uk-flex-wrap uk-margin-small-bottom">                            <div class="uk-text-primary">                                <span class="uk-visible@s">'+e.monitor["90dRatio"].ratio+'%</span>                                <span class="uk-hidden@s">'+e.monitor["30dRatio"].ratio+'%</span>                            </div>                        </div>                        <div class="psp-charts">                            <div>                                <svg width="'+h+'" height="'+v+'" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 '+h+" "+v+'">                                '+d+"                                </svg>                            </div>                        </div>                    </div>";$(".psp-uptime-chart").html(T);var _=DOMPurify.sanitize(window.location.href.replace(location.search,"").replace(/\/$/,""));$(".psp-calendar-link").attr("href",_+"/calendar"),"Heartbeat"!=e.monitor.type&&$(".rt-section").removeClass("uk-hidden");var A=e.monitor.name;if($("#overall-uptime div:nth-child(1) h3").text(e.monitor["1dRatio"].ratio+"%"),$("#overall-uptime div:nth-child(2) h3").text(e.monitor["7dRatio"].ratio+"%"),$("#overall-uptime div:nth-child(3) h3").text(e.monitor["30dRatio"].ratio+"%"),$("#overall-uptime div:nth-child(4) h3").text(e.monitor["90dRatio"].ratio+"%"),logs=e.monitor.logs,t)loadMore();else{var L,S=$(".event-table-wrapper > div:first-child").data("ts");S&&S<logs[0].time&&($.each(logs,function(t,e){var a=trans("status.running_again"),s="icon-arrow-up-circle";"down"==e.label?(a=A+" is down for "+e.duration,s="icon-arrow-down-circle"):"paused"==e.label?(a=trans("status.monitor_paused"),s="icon-pause-circle"):"started"==e.label?(a=trans("status.monitor_started"),s="icon-play-circle"):e.label,e.time>S&&(L+='<div class="psp-announcement psp-alert" data-ts="'+e.time+'"><div class="uk-flex">',L+='<svg class="icon '+s+' uk-flex-none"><use href="images/symbol-defs.svg#'+s+'"></use></svg>',L+='    <div class="uk-flex-auto">',L+='        <h4 class="uk-margin-remove">'+a+"</h4>",L+='        <div class="uk-label" uk-tooltip title="'+e.dateGMT+' GMT">'+e.date+" GMT "+window.timeZone+"</div>","down"==e.label&&null!=e.reason.detail&&(L+='<p class="uk-text-muted psp-alert-reason">'+trans("status.log_reason")+" <strong>"+e.reason.detail.short+'</strong> <strong class="uk-label uk-label-danger">'+e.reason.code+"</strong></p>",void 0!==e.reason.detail.full&&(L+='<p class="psp-alert-reason-detail uk-text-muted"><strong>Details:</strong> <em class="uk-text-muted">'+e.reason.detail.full+"</em></p>")),L+="    </div>",L+="</div></div>")}),$(".event-table-wrapper").append(L))}if("Heartbeat"!=e.monitor.type){var R=[],z=[],D=[],G=e.monitor.responseTimes;if(G.length>0){$.each(G,function(t,e){R.push(e.datetime),z.push({meta:e.datetime,value:e.value}),null!==e.value&&D.push(e.value)});var O=100*Math.round(Math.max(...D)/100),P=Math.max(...D),N=Math.min(...D);if(G.length>1)new Chartist.Line("#chart-container",{labels:R,series:[z]},{showArea:!0,fullWidth:!0,showLabel:!1,chartPadding:{top:10,left:0,bottom:0,right:0},axisX:{showLabel:!1,showGrid:!1},axisY:{type:Chartist.FixedScaleAxis,labelInterpolationFnc:function(t){return t+"ms"},offset:0,position:"start",onlyInteger:!0,labelOffset:{x:0,y:38},low:0,ticks:[O/2]},lineSmooth:Chartist.Interpolation.cardinal({tension:5,fillHoles:!1}),plugins:[Chartist.plugins.tooltip({anchorToPoint:!0,date:!0})]}).on("draw",function(t){"label"===t.type&&t.element.attr({width:"50px"}),"line"!==t.type&&"area"!==t.type||t.element.animate({d:{begin:1e3*t.index,dur:1e3,from:t.path.clone().scale(1,0).translate(0,t.chartRect.height()).stringify(),to:t.path.clone().stringify(),easing:Chartist.Svg.Easing.easeOutQuint}}),$('#chart-container [class*="psp-fake-"]').hide()});else $("#chart-container").html('<div class="uk-text-center uk-text-muted uk-padding">'+trans("common.no_history")+".</div>")}else $("#chart-container").html('<div class="uk-text-center uk-text-muted uk-padding">'+trans("common.no_history"));if(e.monitor.responseTimeStats)$("#avg-rt").text(e.monitor.responseTimeStats.avg_response_time+"ms"),$("#h-rt").text(e.monitor.responseTimeStats.max_response_time+"ms"),$("#l-rt").text(e.monitor.responseTimeStats.min_response_time+"ms");else{var j=D.reduce(function(t,e){return t+e},0)/D.length;$("#avg-rt").text(void 0===j?"N/A":Math.round(j)+"ms"),$("#h-rt").text(void 0===P?"N/A":Math.round(P)+"ms"),$("#l-rt").text(void 0===N?"N/A":Math.round(N)+"ms")}}"#logs"==window.location.hash&&1==t&&$("html, body").animate({scrollTop:$("#logs").offset().top-50},400)},error:function(t){console.log(t)}})}$(function(){setInterval(countdown,1e3);$(".last-updated").text((new Date).toLocaleTimeString()),callMonitorDetail(!0),$("#load-more-logs-button").on("click",function(){loadMore($("#load-more-logs-button").data("monitor-name"))})});
//# sourceMappingURL=detail.min.js.map